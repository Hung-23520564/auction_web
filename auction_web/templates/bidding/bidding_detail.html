{% extends "base.html" %}
{% load static %}
{% load i18n %} {# Nếu bạn dùng i18n cho các chuỗi text động #}
{# {% load humanize %} Nếu bạn dùng để format số, ngày giờ #}

{% block title %}Đặt giá{% endblock title %}

{% block page_specific_css %}
    {# <link rel="stylesheet" href="{% static 'css/home.css' %}"> #}
    <link rel="stylesheet" href="{% static 'css/bidding_detail.css' %}">
{% endblock page_specific_css %}

{% block content %}
<main class="container bidding-detail-main-content">
    <h1 id="item-name-heading" class="page-main-title">Đang tải thông tin sản phẩm...</h1>

    <div class="bidding-detail-layout">

        <section class="bidding-column bidding-item-info">
            <h2 class="section-title">Thông tin sản phẩm</h2>
            <div class="item-card-display">
                <!-- Ảnh sản phẩm sẽ được JS cập nhật -->
                <div class="item-image-container">
                    <img id="item-image" src="{% static 'images/placeholder_item_large.png' %}" alt="Hình ảnh sản phẩm">
                </div>
                <h3 id="item-name" class="item-title-detail"></h3>
                <p class="item-seller-info">Người bán: <span id="item-seller">Đang tải...</span></p>
            </div>
            <div class="price-chart-placeholder" id="price-chart-container">
                <p>(Biểu đồ lịch sử giá sẽ được hiển thị ở đây)</p>
            </div>
        </section>

        <section class="bidding-column bidding-history">
            <h2 class="section-title">Lịch sử đặt giá</h2>
            <div class="bid-list-wrapper">
                <div class="bid-list">
                    <table class="bid-history-table">
                        <thead>
                            <tr>
                                <th>Giá đặt</th>
                                <th>Người đặt</th>
                                <th>Thời gian</th>
                            </tr>
                        </thead>
                        <tbody id="bid-history-table-body">
                            <tr><td colspan="3" class="loading-text">Đang tải lịch sử đấu giá...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="current-price-display">
                Giá hiện tại: <strong id="current-price" class="current-price-value">Đang tải...</strong>
            </div>
        </section>

        <section class="bidding-column bidding-actions">
            <h2 class="section-title">Đặt giá của bạn</h2>
            <div class="action-details-box">
                <p>Giá khởi điểm: <strong id="starting-price">Đang tải...</strong> VNĐ</p>
                <p>Thời gian còn lại: <strong id="time-remaining" class="time-critical">Đang tải...</strong></p>
            </div>

            <form id="place-bid-form" class="bid-form-box">
                {% csrf_token %}
                <!-- Input ẩn chứa ID item (sẽ được JS điền vào hoặc server render nếu có context item) -->
                <input type="hidden" name="item_id" id="form-item-id" value="{{ item.pk | default:'' }}">
                {# user_id không nên lấy từ client, backend nên tự lấy request.user.id khi xử lý bid #}

                <div class="form-group">
                    <label for="bid-amount-input" id="min-bid-label">Giá đặt (Tối thiểu: <span id="min-bid-value">Đang tải...</span> VNĐ):</label>
                    <div class="price-input-wrapper">
                        <input type="number" id="bid-amount-input" name="bid_amount" min="0" placeholder="Nhập số tiền" required>
                        <span class="currency-symbol">VNĐ</span>
                    </div>
                </div>

                <div class="bid-summary">
                    Tổng cộng: <strong id="total-bid-value">0</strong> VNĐ
                </div>

                <div class="action-buttons">
                    <button type="button" class="btn btn-secondary btn-cancel-bid">Hủy</button>
                    <button type="submit" class="btn btn-primary btn-submit-bid">Đặt giá</button>
                </div>
                <p id="bid-form-message" class="form-message"></p>
            </form>
        </section>
    </div>
</main>
{% endblock content %}

{% block page_specific_js %}
    <script src="{% static 'js/bidding_detail.js' %}"></script>
{% endblock page_specific_js %}